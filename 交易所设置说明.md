# VeighNa 交易所设置的作用和影响

## 交易所的核心作用

### 1. 生成唯一标识符（vt_symbol）

在VeighNa中，**合约代码 + 交易所 = 本地代码（vt_symbol）**

```
vt_symbol = f"{symbol}.{exchange}"
```

例如：
- `000001.SSE` - 上证指数（上交所）
- `000001.SZSE` - 深证成指（深交所）
- `899050.BSE` - 北证50（北交所）

**即使代码相同，不同交易所也会生成不同的vt_symbol！**

### 2. 数据存储和查询

在数据库中，数据是按照以下组合存储的：
- **symbol**（合约代码）
- **exchange**（交易所）
- **interval**（周期）

这三个字段组合起来，才能唯一确定一条数据。

### 3. 回测和交易中的使用

在CTA回测、策略回测等模块中，需要使用 **vt_symbol** 来指定要使用的数据：

```python
# 回测时需要指定完整的vt_symbol
vt_symbol = "899050.BSE"  # 北证50
# 而不是仅仅 "899050"
```

## 交易所设置错误的影响

### 如果交易所设置错误会怎样？

#### 场景1：数据导入时交易所错误

**错误示例**：
- 代码：`899050`
- 交易所：`CFFEX`（中金所）❌ 错误！
- 实际应该是：`BSE`（北交所）✓

**影响**：
1. ✅ 数据可以成功导入（不会报错）
2. ❌ 但vt_symbol会变成 `899050.CFFEX` 而不是 `899050.BSE`
3. ❌ 在回测时，如果使用 `899050.BSE` 查找数据，会找不到
4. ❌ 如果使用 `899050.CFFEX` 查找数据，能找到，但这是错误的数据标识

#### 场景2：回测时vt_symbol不匹配

```python
# 如果导入时用的是 CFFEX
# 数据库中存储的是：symbol=899050, exchange=CFFEX
# vt_symbol = "899050.CFFEX"

# 但回测时使用
vt_symbol = "899050.BSE"  # 找不到数据！

# 必须使用
vt_symbol = "899050.CFFEX"  # 才能找到，但这是错误的标识
```

## 正确的交易所映射

根据你的数据文件，正确的交易所应该是：

| 文件名 | 合约代码 | 正确交易所 | vt_symbol |
|--------|---------|-----------|-----------|
| 上证指数_sh000001 | 000001 | SSE | 000001.SSE |
| 深证成指_sz399001 | 399001 | SZSE | 399001.SZSE |
| 创业板指_sz399006 | 399006 | SZSE | 399006.SZSE |
| 科创50_sh000688 | 000688 | SSE | 000688.SSE |
| 北证50_bj899050 | 899050 | BSE | 899050.BSE |
| 恒生指数_^HSI | HSI | NONE 或 GLOBAL | HSI.NONE |
| 恒生科技_^HSTECH | HSTECH | NONE 或 GLOBAL | HSTECH.NONE |
| 标普500_^GSPC | GSPC | NONE 或 GLOBAL | GSPC.NONE |
| 纳斯达克_^IXIC | IXIC | NONE 或 GLOBAL | IXIC.NONE |
| 道琼斯_^DJI | DJI | NONE 或 GLOBAL | DJI.NONE |

## 如何检查交易所是否正确

### 方法1：查看数据管理模块

1. 导入数据后，点击 **刷新**
2. 查看数据列表，检查交易所列显示的是什么
3. 如果显示错误，需要重新导入（删除错误数据，用正确的交易所重新导入）

### 方法2：查看数据库

数据在数据库中的存储格式：
```python
# 查询数据时需要指定
symbol = "899050"
exchange = Exchange.BSE  # 必须是正确的交易所
interval = Interval.DAILY
```

## 总结

### 交易所设置的重要性

1. **必须正确**：交易所是数据标识的一部分，错误会导致数据无法正确使用
2. **影响回测**：回测时必须使用正确的vt_symbol（包含正确的交易所）
3. **影响查询**：查询数据时必须匹配正确的交易所
4. **影响交易**：实盘交易时，交易所决定了连接到哪个交易所

### 建议

1. **导入前确认**：导入数据前，确认每个合约的正确交易所
2. **参考文件名**：文件名中的前缀（sh/sz/bj/^）可以帮助判断交易所
3. **统一管理**：建议创建一个映射表，记录每个合约的正确交易所
4. **验证数据**：导入后，在数据管理模块中验证交易所是否正确

### 如果已经导入错误了怎么办？

1. 在数据管理模块中删除错误的数据
2. 使用正确的交易所重新导入
3. 或者使用脚本批量修正数据库中的交易所字段（需要直接操作数据库）

