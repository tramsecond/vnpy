# 多标的回测图形界面显示说明

## 图表显示方式

当你运行 `multi_symbol_backtest.py` 脚本时，会在**浏览器中自动弹出**一个交互式图表窗口，显示组合回测的结果。

## 图表内容

图表由**4个子图**组成，从上到下依次为：

### 1. 账户净值图 (Balance)
- **横轴**：时间（日期）
- **纵轴**：账户资金（元）
- **内容**：显示组合账户净值随时间的变化曲线
- **说明**：这是所有标的的盈亏合并后的总账户净值曲线

### 2. 净值回撤图 (Drawdown)
- **横轴**：时间（日期）
- **纵轴**：回撤金额（元）
- **内容**：显示从最近高点回撤的程度
- **说明**：红色填充区域表示回撤，数值越大表示回撤越严重

### 3. 每日盈亏图 (Daily Pnl)
- **横轴**：时间（日期）
- **纵轴**：每日盈亏金额（元）
- **内容**：柱状图显示每个交易日的盈亏情况
- **说明**：
  - 绿色柱子 = 盈利
  - 红色柱子 = 亏损
  - 这是所有标的的每日盈亏合并后的结果

### 4. 盈亏分布图 (Pnl Distribution)
- **横轴**：盈亏金额（元）
- **纵轴**：交易日数量
- **内容**：直方图显示盈亏的分布情况
- **说明**：可以看出盈利日和亏损日的分布特征

## 图表特点

### 交互式功能
- ✅ **缩放**：可以用鼠标滚轮或拖拽缩放图表
- ✅ **平移**：可以拖拽图表查看不同时间段
- ✅ **悬停**：鼠标悬停在数据点上可以看到具体数值
- ✅ **图例**：可以点击图例显示/隐藏对应的数据系列
- ✅ **工具条**：图表顶部有工具条，可以：
  - 下载图表为PNG格式
  - 缩放、平移、选择区域
  - 重置视图

### 显示位置
- 图表会在**默认浏览器**中自动打开
- 如果浏览器没有自动打开，可以查看控制台输出的URL，手动访问

## 统计指标输出

除了图表，脚本还会在**控制台**输出详细的统计指标，包括：

```
------------------------------
首个交易日：    2020-01-02
最后交易日：    2026-01-07
总交易日：      1,461
盈利交易日：    730
亏损交易日：    731
起始资金：      1,000,000.00
结束资金：      1,234,567.89
总收益率：      23.46%
年化收益：      4.12%
最大回撤:       -123,456.78
百分比最大回撤: -10.23%
总盈亏：        234,567.89
总手续费：      12,345.67
总滑点：        0.00
总成交金额：    123,456,789.00
总成交笔数：    1,234.0
日均盈亏：      160.67
日均手续费：    8.45
日均滑点：      0.00
日均成交金额：  84,567.89
日均成交笔数：  0.85
日均收益率：    0.11%
收益标准差：    1.23%
Sharpe Ratio：  0.89
收益回撤比：    0.19
```

## 与单标的回测的区别

### 单标的回测
- 图表显示的是**单个标的**的回测结果
- 账户净值 = 单个标的的盈亏
- 每日盈亏 = 单个标的的每日盈亏

### 多标的回测（组合回测）
- 图表显示的是**所有标的合并后**的回测结果
- 账户净值 = 所有标的的盈亏相加
- 每日盈亏 = 所有标的的每日盈亏相加
- **优势**：
  - 可以看到组合的整体表现
  - 可以评估策略在不同标的上的分散效果
  - 可以观察组合的风险分散情况

## 示例说明

假设你回测了5个标的：
- 000001.SSE（上证指数）
- 399001.SZSE（深证成指）
- 399006.SZSE（创业板指）
- 000688.SSE（科创50）
- 899050.BSE（北证50）

图表显示的是这5个标的的**合并结果**：
- 如果某一天，上证指数盈利1000元，深证成指亏损500元，创业板指盈利300元...
- 那么图表中这一天的盈亏 = 1000 - 500 + 300 + ... = 所有标的盈亏的总和

## 注意事项

1. **浏览器要求**：需要现代浏览器（Chrome、Firefox、Edge等）支持
2. **Plotly库**：图表使用Plotly库生成，如果未安装会自动安装
3. **数据对齐**：不同标的的数据日期可能不完全一致，脚本会自动处理
4. **资金分配**：当前脚本假设每个标的使用相同的资金，实际可以根据需要调整

## 如何查看单个标的的结果

如果你想查看单个标的的回测结果，可以：

1. **修改脚本**：在 `run_single_backtest` 函数中添加：
   ```python
   engine.show_chart(df)  # 在返回df之前显示单个标的的图表
   ```

2. **分别运行**：使用VeighNa Trader的GUI界面，分别对每个标的进行回测

3. **保存结果**：在脚本中添加保存功能，将每个标的的结果保存为CSV文件

## 图表保存

图表右上角有工具条，可以：
- 点击📷图标下载为PNG图片
- 点击📊图标下载为SVG矢量图
- 点击💾图标下载为HTML文件（可以离线查看）

