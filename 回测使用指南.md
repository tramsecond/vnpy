# VeighNa CTA回测使用指南

## 使用已导入的数据进行回测

### 已导入的数据列表

根据批量导入的结果，以下数据已成功导入到VeighNa数据库：

| 合约名称 | 本地代码 (vt_symbol) | 周期 | 数据条数 | 时间范围 |
|---------|---------------------|------|---------|---------|
| 上证指数 | `000001.SSE` | d (日线) | 1,458 | 2020-01-02 至 2026-01-07 |
| 深证成指 | `399001.SZSE` | d (日线) | 1,458 | 2020-01-02 至 2026-01-07 |
| 创业板指 | `399006.SZSE` | d (日线) | 1,458 | 2020-01-02 至 2026-01-07 |
| 科创50 | `000688.SSE` | d (日线) | 1,458 | 2020-01-02 至 2026-01-07 |
| 北证50 | `899050.BSE` | d (日线) | 895 | 2022-05-05 至 2026-01-07 |
| 恒生指数 | `HSI.GLOBAL` | d (日线) | 1,480 | 2020-01-02 至 2026-01-07 |
| 恒生科技 | `HSTECH.GLOBAL` | d (日线) | 1,325 | 2020-08-17 至 2026-01-07 |
| 标普500 | `GSPC.GLOBAL` | d (日线) | 1,512 | 2020-01-02 至 2026-01-07 |
| 纳斯达克 | `IXIC.GLOBAL` | d (日线) | 1,512 | 2020-01-02 至 2026-01-07 |
| 道琼斯 | `DJI.GLOBAL` | d (日线) | 1,512 | 2020-01-02 至 2026-01-07 |

## CTA回测配置步骤

### 1. 打开CTA回测模块

在VeighNa Trader中：
- 点击 **功能** → **CTA回测**

### 2. 配置回测参数

#### 策略品种
- **交易策略**: 选择要回测的策略（如 `AtrRsiStrategy`）
- **本地代码**: **重要！** 必须使用正确的vt_symbol格式
  - ✅ 正确示例：`000001.SSE`（上证指数）
  - ✅ 正确示例：`899050.BSE`（北证50）
  - ❌ 错误示例：`000001`（缺少交易所后缀）
  - ❌ 错误示例：`IF88.CFFEX`（这是期货合约，你导入的是股票指数）

#### 数据范围
- **K线周期**: 选择 `d`（日线），因为你的数据都是日线数据
- **开始日期**: 根据数据时间范围填写，格式 `yyyy/mm/dd`
  - 例如：`2020/01/02`（上证指数）
  - 例如：`2022/05/05`（北证50）
- **结束日期**: 根据数据时间范围填写
  - 例如：`2026/01/07`

#### 交易成本（股票指数回测建议）
- **手续费率**: 股票交易通常为 `0.0003`（万三）或 `0.00025`（万2.5）
- **交易滑点**: `0` 或 `0.1`（股票滑点较小）
- **合约乘数**: `1`（股票通常为1）
- **价格跳动**: `0.01`（股票最小变动单位为0.01元）
- **回测资金**: 例如 `1000000`（100万）

### 3. 开始回测

1. **不要点击"下载数据"按钮** - 因为数据已经导入到数据库了
2. 直接点击 **"开始回测"** 按钮
3. 回测引擎会自动从数据库加载数据

## 重要提示

### ⚠️ 关于"下载数据"按钮

- **如果数据已导入**：不需要点击"下载数据"
- **如果点击下载数据**：会尝试从数据服务下载，如果没有配置数据服务会报错
- **已导入的数据**：CTA回测会自动从数据库读取，无需下载

### ✅ 正确的使用流程

1. 数据已通过批量导入脚本导入到数据库 ✓
2. 在CTA回测界面填写正确的vt_symbol（如 `000001.SSE`）
3. 选择正确的周期（`d` - 日线）
4. 填写数据时间范围
5. 直接点击"开始回测"，**不要点击"下载数据"**

### 📝 回测示例配置

以**上证指数**为例：

```
交易策略: AtrRsiStrategy
本地代码: 000001.SSE
K线周期: d
开始日期: 2020/01/02
结束日期: 2026/01/07
手续费率: 0.0003
交易滑点: 0
合约乘数: 1
价格跳动: 0.01
回测资金: 1000000
```

## 常见问题

### Q1: 为什么提示"没有正确配置数据服务"？

**A**: 这是因为你点击了"下载数据"按钮。如果数据已经导入到数据库，**不需要下载数据**，直接点击"开始回测"即可。

### Q2: 如何确认数据是否已导入？

**A**: 
1. 打开 **功能** → **数据管理**
2. 点击 **刷新** 按钮
3. 查看数据列表，确认是否有对应的合约数据

### Q3: 回测时找不到数据怎么办？

**A**: 检查以下几点：
1. vt_symbol是否正确（必须包含交易所后缀，如 `.SSE`）
2. 周期是否匹配（你的数据是日线，必须选择 `d`）
3. 日期范围是否在数据范围内

### Q4: 股票指数可以用CTA策略回测吗？

**A**: 可以，但需要注意：
- 股票指数通常使用日线数据
- 合约乘数设置为 `1`
- 价格跳动设置为 `0.01`
- 手续费率根据实际情况设置（通常0.0003左右）

## 快速开始

1. 打开 **功能** → **CTA回测**
2. 填写：
   - 本地代码：`000001.SSE`（或其他已导入的合约）
   - K线周期：`d`
   - 开始日期：`2020/01/02`
   - 结束日期：`2026/01/07`
3. 配置交易成本参数
4. **直接点击"开始回测"**（不要点击"下载数据"）

