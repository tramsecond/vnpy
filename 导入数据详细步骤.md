# VeighNa 数据导入详细步骤

## 错误解决：KeyError: 'datetime'

如果遇到 `KeyError: 'datetime'` 错误，说明在导入对话框中**表头信息**配置不正确。

## 正确导入步骤

### 1. 准备CSV文件

确保CSV文件包含以下列（顺序不重要）：
- `datetime` - 时间戳
- `open` - 开盘价
- `high` - 最高价
- `low` - 最低价
- `close` - 收盘价
- `volume` - 成交量
- `open_interest` - 持仓量（可选，股票数据可以没有）

### 2. 在VeighNa中导入

1. 启动VeighNa Trader
2. 点击 **功能** → **数据管理**
3. 点击右上角 **导入数据** 按钮
4. 点击 **选择文件**，选择你的CSV文件

### 3. 配置导入参数（重要！）

#### 合约信息
- **代码**: 例如 `000001`（上证指数）
- **交易所**: 例如 `SSE`（上交所）
- **周期**: 选择对应的周期
  - 日线 → `DAILY`
  - 分钟线 → `MINUTE`
  - 小时线 → `HOUR`
  - 周线 → `WEEKLY`

#### 表头信息（关键！）

**必须准确填写CSV文件中的实际列名！**

在导入对话框的"表头信息"部分，需要填写：

```
datetime: datetime
open: open
high: high
low: low
close: close
volume: volume
open_interest: open_interest
```

或者如果CSV文件没有 `open_interest` 列，可以留空：

```
datetime: datetime
open: open
high: high
low: low
close: close
volume: volume
open_interest: 
```

**注意**：
- 冒号左边是VeighNa需要的字段名（固定）
- 冒号右边是CSV文件中的实际列名（必须匹配）
- 如果CSV列名是 `date` 而不是 `datetime`，应该写：`datetime: date`

#### 格式信息

- **时间格式**: 
  - 如果只有日期：`%Y-%m-%d`
  - 如果有日期和时间：`%Y-%m-%d %H:%M:%S`
  - 如果只有日期和小时分钟：`%Y-%m-%d %H:%M`

### 4. 常见问题

#### 问题1: KeyError: 'datetime'
**原因**: 表头信息中 `datetime:` 后面填写的内容与CSV文件中的列名不匹配

**解决**: 
1. 打开CSV文件，查看第一行的列名
2. 确保表头信息中 `datetime:` 后面填写的是CSV文件中的实际列名
3. 如果CSV列名是 `date`，应该写 `datetime: date`

#### 问题2: 编码问题
**原因**: CSV文件编码不是UTF-8

**解决**: 
- 转换脚本已经使用 `utf-8-sig` 编码保存
- 如果还有问题，可以用Excel打开CSV，另存为UTF-8编码

#### 问题3: 时间格式错误
**原因**: 时间格式字符串与CSV中的时间格式不匹配

**解决**: 
- 查看CSV文件中的时间格式
- 例如：`2022-05-05` → `%Y-%m-%d`
- 例如：`2022-05-05 09:30:00` → `%Y-%m-%d %H:%M:%S`

## 示例配置

假设CSV文件内容如下：
```csv
datetime,open,high,low,close,volume,open_interest
2022-05-05,1000.585,1036.86,993.928,1031.315,49876843,0
```

导入配置应该是：
- **代码**: `899050`
- **交易所**: `BSE`
- **周期**: `DAILY`
- **表头信息**:
  ```
  datetime: datetime
  open: open
  high: high
  low: low
  close: close
  volume: volume
  open_interest: open_interest
  ```
- **时间格式**: `%Y-%m-%d`

## 验证CSV文件

在导入前，可以用文本编辑器打开CSV文件，确认：
1. 第一行是列名
2. 列名与表头信息中填写的一致
3. 时间格式与时间格式字符串匹配

