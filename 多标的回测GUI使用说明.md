# 多标的回测GUI工具使用说明

## 功能特点

✅ **图形界面操作**：完全在GUI中操作，无需编写代码  
✅ **多页签显示**：每个标的单独显示一个页签，方便对比  
✅ **汇总统计**：自动计算所有标的的平均值和对比图表  
✅ **交互式图表**：使用Plotly显示交互式图表，支持缩放、悬停等操作  
✅ **详细统计**：显示完整的回测统计指标

## 启动方式

```bash
python multi_symbol_backtest_gui.py
```

## 使用步骤

### 1. 选择标的

在左侧的"选择标的"列表中，**按住Ctrl键**点击多个标的进行多选，或者**按住Shift键**选择连续多个标的。

可用的标的包括：
- 上证指数 (000001.SSE)
- 深证成指 (399001.SZSE)
- 创业板指 (399006.SZSE)
- 科创50 (000688.SSE)
- 北证50 (899050.BSE)
- 恒生指数 (HSI.GLOBAL)
- 恒生科技 (HSTECH.GLOBAL)
- 标普500 (GSPC.GLOBAL)
- 纳斯达克 (IXIC.GLOBAL)
- 道琼斯 (DJI.GLOBAL)

### 2. 配置回测参数

- **策略**：选择要使用的CTA策略（目前支持AtrRsiStrategy）
- **周期**：选择数据周期（日线/小时/分钟）
- **开始日期**：回测开始日期
- **结束日期**：回测结束日期
- **回测资金**：账户初始资金
- **手续费率**：交易手续费率（例如：0.0003 表示万三）

### 3. 开始回测

点击"开始回测"按钮，系统会：
1. 显示进度对话框
2. 依次对每个选中的标的进行回测
3. 为每个标的创建结果页签
4. 最后创建汇总统计页签

### 4. 查看结果

#### 单个标的页签

每个标的的页签包含：

**左侧：统计指标**
- 日期信息（首个交易日、最后交易日、总交易日等）
- 资金盈亏（起始资金、结束资金、总收益率、年化收益、最大回撤等）
- 交易成本（总手续费、总滑点、总成交金额、总成交笔数等）
- 日均数据（日均盈亏、日均手续费、日均收益率等）
- 绩效评价（Sharpe比率、收益回撤比等）

**右侧：交互式图表**
- **账户净值图**：显示账户净值随时间的变化
- **净值回撤图**：显示从高点的回撤情况
- **每日盈亏图**：柱状图显示每日盈亏（绿色=盈利，红色=亏损）
- **盈亏分布图**：直方图显示盈亏的分布情况

#### 汇总统计页签

汇总页签包含：

**左侧：汇总表格**
- **平均值**：所有标的的统计指标平均值
  - 总收益率平均值
  - 年化收益平均值
  - 最大回撤平均值
  - Sharpe比率平均值
  - 等等...
- **各标的表现**：每个标的的关键指标对比
  - 收益、Sharpe比率、回撤

**右侧：对比图表**
- **总收益率对比**：柱状图对比各标的的总收益率
- **Sharpe比率对比**：柱状图对比各标的的Sharpe比率
- **最大回撤对比**：柱状图对比各标的的最大回撤
- **年化收益对比**：柱状图对比各标的的年化收益

## 图表交互功能

所有图表都支持以下交互功能：

- ✅ **缩放**：鼠标滚轮或拖拽缩放
- ✅ **平移**：拖拽查看不同时间段
- ✅ **悬停**：鼠标悬停显示具体数值
- ✅ **图例**：点击图例显示/隐藏数据系列
- ✅ **下载**：可以保存为PNG/SVG/HTML格式

## 注意事项

1. **数据要求**：确保数据库中已有对应标的的历史数据
2. **WebEngine支持**：
   - 如果安装了`PySide6-WebEngine`，图表会直接嵌入在GUI中
   - 如果没有安装，图表会在浏览器中打开
3. **回测时间**：回测时间取决于数据量和标的数量，请耐心等待
4. **策略参数**：目前使用默认策略参数，后续可以扩展支持自定义参数

## 与单标的回测的区别

| 特性 | 单标的回测 | 多标的回测GUI |
|------|-----------|--------------|
| 操作方式 | GUI或脚本 | 纯GUI操作 |
| 结果展示 | 单个结果 | 多页签+汇总 |
| 对比分析 | 需要手动对比 | 自动汇总和对比 |
| 数据汇总 | 简单相加 | 平均值+各标的表现 |

## 扩展功能

如果需要添加更多功能，可以：

1. **添加更多策略**：在`strategy_combo`中添加更多策略选项
2. **自定义策略参数**：添加策略参数配置对话框
3. **导出结果**：添加导出Excel/CSV功能
4. **保存配置**：保存和加载回测配置

## 故障排除

### 问题：图表不显示

**解决方案**：
- 如果使用WebEngine，确保安装了`PySide6-WebEngine`：
  ```bash
  pip install PySide6-WebEngine
  ```
- 如果没有安装，图表会在浏览器中自动打开

### 问题：回测失败

**可能原因**：
1. 数据库中没有对应标的的数据
2. 日期范围超出数据范围
3. 策略参数错误

**解决方案**：
- 检查数据库中是否有数据
- 调整日期范围
- 查看错误信息中的详细提示

### 问题：统计指标计算失败

**解决方案**：
- 检查df数据格式是否正确
- 查看控制台输出的详细错误信息

